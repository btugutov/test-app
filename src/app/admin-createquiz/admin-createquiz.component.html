<div class="admin-create-quiz" *ngIf="currentUser && engagements">
    <div [hidden]="!modal_mesage_bool" class="modal_message_box">
        <div class="modal-dialog modal-dialog-centered modal_message" role="document">
            <!-- EDIT/REMOVE BUCKET LIST -->
            <div class="modal-content " *ngIf="modal_message.title == 'Edit/Remove Buckets'">
                <div>
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalCenteredLabel">{{modal_message.title}}</h5>
                        <button type="button" class="close" (click)="bucketListEditorClose()" data-dismiss="modal" aria-label="Close">
                              <span aria-hidden="true">&times;</span>
                            </button>
                    </div>
                    <div class="modal-body modal-edit-remove-bucket">
                        <table [hidden]="bucket_list_confirm_bool" class="table table-borderless table-sm">
                                <thead class="thead-light">
                                    <tr>
                                        <th>ID</th>
                                        <th>Bucket Title</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr *ngFor="let b of bucket_list; index as i">
                                        <th *ngIf="!b.soft_delete" scope="row">{{b.bucket_id}}</th>
                                        <td *ngIf="!b.soft_delete">
                                            <input type="text" class="form-control openBucketListSettings_inputs" (change)="bucketListEditor(i, 'bucket_name', $event.target.value)" value={{b.bucket_name}}>
                                        </td>
                                        <td *ngIf="!b.soft_delete">
                                            <button *ngIf="!b.soft_delete" (click)="bucketListEditor(i, 'soft_delete', true)" class='btn btn-outline-danger btn-action-borderless'>Disable</button>
                                        </td>
    
                                        <th *ngIf="b.soft_delete" class="table-secondary" scope="row">{{b.bucket_id}}</th>
                                        <td *ngIf="b.soft_delete" class="table-secondary">
                                            <input type="text" disabled class="form-control openBucketListSettings_inputs" (change)="bucketListEditor(i, 'bucket_name', $event.target.value)" value={{b.bucket_name}}>
                                        </td>
                                        <td *ngIf="b.soft_delete" class="table-secondary">
                                            <button *ngIf="b.soft_delete" (click)="bucketListEditor(i, 'soft_delete', false)" class='btn btn-outline-success btn-action-borderless'>Enable</button>
                                        </td>
                                    </tr>
                                </tbody>
                        </table>
                        <table [hidden]="!bucket_list_confirm_bool" class="table table-borderless table-sm">
                                <thead class="thead-light">
                                    <tr>
                                        <th>ID</th>
                                        <th>Bucket Name</th>
                                        <th>Bucket change</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr *ngFor="let b of bucket_list_confirm_list | keyvalue">
                                        <th  scope="row">{{b.key}}</th>
                                        <td>{{b.value['bucket_name']}}</td>
                                        <td>
                                            <p *ngIf="b.value['New Bucket name']">New name: <span class="text-success" >{{b.value['New Bucket name']}}</span></p>
                                            <p *ngIf="b.value['status']">Now is 
                                                <span *ngIf="!b.value['soft_delete']" class="text-success">{{b.value['status']}}</span>
                                                <span *ngIf="b.value['soft_delete']" class="text-danger">{{b.value['status']}}</span>
                                            </p>
                                        </td>
                                        <td>
                                            <button  (click)="bucketUndoOne(b.key, b.value['index'])" class='btn btn-outline-warning btn-action-borderless'>Undo</button>
                                        </td>
                                    </tr>
                                </tbody>
                        </table>

                    </div>
                    <div class="modal-footer">
                        <button type="button" *ngIf="bucket_list_changes_bool" class="btn btn-action-borderless btn-outline-danger" (click)="bucketListEditorCancel()" data-dismiss="modal">Cancel changes</button>
                        <button type="button" *ngIf="!bucket_list_changes_bool" class="btn btn-action-borderless btn-outline-info" (click)="bucketListEditorClose()" data-dismiss="modal">Close</button>
                        <button type="button" [hidden]="bucket_list_confirm_bool" class="btn btn-action-borderless btn-outline-warning" (click)="bucketListEditorConfirm()">Confirm</button>
                        <button type="button" [hidden]="!bucket_list_confirm_bool" class="btn btn-action-borderless btn-outline-success" (click)="bucketListEditorSave()">Save</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="admin-create-quiz-title">
        <h1>Create a new quiz</h1>
    </div>
    <div class="admin-create-quiz-body">
        <div class="admin-create-quiz-body-topic-cat-eng-box">
            <div class="input-group">
                <div class="admin-create-quiz-body-topic-cat-eng-box-select-box">
                    <span class="text-muted">Engagement</span>
                    <select class="custom-select" (change)="valueChanger('engagement', $event.target.value)">
                        <option *ngFor="let eng of engagements" [selected]="eng.engagement_id==currentEng_id"
                            [disabled]="eng.soft_delete" value={{eng.engagement_id}}>{{eng.engagement_name}}</option>
                    </select>
                </div>
                <div class="admin-create-quiz-body-topic-cat-eng-box-select-box">
                    <span class="text-muted">Category</span>
                    <input [disabled]="!selected_eng" class="custom-select" type="text" id="category_selector" list="categories" (change)="valueChanger('category', $event.target.value)" />
                    <datalist id="categories">
                        <select class="custom-select">
                            <option *ngFor="let c of categories_list | keyvalue" [value]="c.key"></option>
                        </select>
                    </datalist>
                </div>
                <div class="admin-create-quiz-body-topic-cat-eng-box-select-box">
                    <span class="text-muted">Topic</span>
                    <input [disabled]="!selected_category" id="topic_selector" class="custom-select" type="text" list="topics" (change)="valueChanger('topic', $event.target.value)" />
                    <datalist id="topics">
                        <select class="custom-select">
                            <option *ngFor="let t of topic_list | keyvalue" [value]="t.value['topic']">(Already exists)
                            </option>
                        </select>
                    </datalist>
                </div>
            </div>
        </div>
        <div *ngIf="topic_cat_eng_message.display" style="margin-top: 15px">
            <div *ngIf="topic_cat_eng_message.status == 'fail'" class="alert alert-warning shadow" role="alert">
                <strong>Warning!</strong> {{topic_cat_eng_message.message}}
            </div>
            <div *ngIf="topic_cat_eng_message.status == 'success'" class="alert alert-success shadow" role="alert">
                <strong>Nice!</strong> {{topic_cat_eng_message.message}}
            </div>
        </div>
    </div>

    <div class='admin-create-quiz-form' style="margin-top: 25px;">
        <table class="table table-borderless">
            <thead class="thead-light">
                <tr style="height: 50px">
                    <th class="border-0 text-uppercase small font-weight-bold text-center" style="width: 5%">ID/Order
                    </th>
                    <th class="border-0 text-uppercase small font-weight-bold text-center">Question prompt</th>
                    <th class="border-0 text-uppercase small font-weight-bold text-center">Image</th>
                    <th class="border-0 text-uppercase small font-weight-bold text-center" style="width: 7%">Display Type
                    </th>
                    <th class="border-0 text-uppercase small font-weight-bold text-center">List of choices/Expected Answer
                    </th>
                    <th class="border-0 text-uppercase small font-weight-bold text-center">Admin notes</th>
                    <th class="border-0 text-uppercase small font-weight-bold text-center" style="width: 5%">Action</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor='let q of list_of_questions | keyvalue' class="create_form_row">
                    <!-- QEUSTIONS -->
                    <td *ngIf="!q.value['error_bool']" class='text-center table-row'>
                        <p>{{q.key}}</p>
                        <div>
                            <input style="width: 100%; padding: 0px 0px !important" (change)="inputEditor('question_sort', q.key, 'question_sort', null, $event.target.value)" class="edit_sort_value form-control create_form_input_shadow" min=1 max=99 type="number" value=1 title="Set Question Priority"
                                data-toggle="tooltip" data-placement="bottom" title="Tooltip on bottom" value="{{list_of_questions[q.key]['question_sort']}}">
                        </div>
                    </td>
                    <td *ngIf="!q.value['error_bool']" style="padding: 0px 3px !important;">
                        <textarea class='textAreaPrompt form-control create_form_input_shadow' (change)="inputEditor('prompt', q.key, 'prompt', null, $event.target.value)" rows=4 name='questionPromts' id='questionPromt_{{q.key}}' value="{{q.value['prompt']}}"></textarea>
                    </td>
                    <td *ngIf="!q.value['error_bool']" class='create_form_img_box' align="center">
                        <div *ngIf="!q.value['image']">
                            <label for="file-upload" style="width: 100%;" class="custom-file-upload btn btn-sm btn-outline-secondary btn-action-borderless">
                                    &#8682; Upload Picture
                                </label>
                            <input id="file-upload" type="file" (change)="inputEditor('img', q.key, 'base64', null, $event.target.files)" accept="image/*" />
                        </div>
                        <div *ngIf="q.value['image']" style="position: relative">
                            <img src="{{q.value['base64']}}" class="img-fluid" alt="Responsive image">
                            <button class="btn btn-sm btn-outline-danger btn-image-remove" (click)="removeImg(q.key)">x</button>
                        </div>
                    </td>
                    <td *ngIf="!q.value['error_bool']">
                        <div class="btn-group-vertical btn-group-toggle" data-toggle="buttons">
                            <label class="btn btn-sm btn-action-borderless btn-outline-secondary" (click)="displayTypeChanger(q.key, 'textfield input')" checked>
                                    <input type="radio" name="displayTypeNew" id="manual_input" value="textfield input"
                                        ng-checked='true' /> Manual Input
                                </label>
                            <label class="btn btn-sm btn-action-borderless btn-outline-secondary" (click)="displayTypeChanger(q.key, 'Radio')">
                                    <input type="radio" name="displayTypeNew " id="radio " value="Radio" /> Radio
                                </label>
                            <label class="btn btn-sm btn-action-borderless btn-outline-secondary " (click)="displayTypeChanger( q.key, 'Dropdown')">
                                    <input type="radio" name="displayTypeNew" id="dropdown" value="Dropdown"> Dropdown
                                </label>
                            <label class="btn btn-sm btn-action-borderless btn-outline-secondary" (click)="displayTypeChanger(q.key, 'Checkbox')">
                                    <input type="radio" name="displayTypeNew " id="checkbox " value="Checkbox "> Checkbox
                                </label>
                            <label class="btn btn-sm btn-action-borderless btn-outline-secondary " (click)="displayTypeChanger( q.key, 'drag_and_drop')">
                                    <input type="radio" name="displayTypeNew" id="drag_and_drop" value="drag_and_drop">
                                    Drag'n'Drop
                                </label>
                        </div>
                    </td>
                    <td *ngIf="!q.value['error_bool']">
                        <!-- NOT SELECTED -->
                        <div *ngIf="!q.value['question_type_description']">
                            <p align="center" class='text-muted'>Please check type of question.</p>
                        </div>


                        <!-- MANUAL INPUT -->
                        <div style="padding: 0px 3px !important;" [hidden]="q.value['question_type_description'] != 'textfield input'">
                            <textarea (change)="inputEditor('expected_response', q.key, 'expected_response', null, $event.target.value)" class='textAreaExpectedAnswer form-control create_form_input_shadow' rows=4 placeholder="Expected answer" value="{{q.value['expected_response']}}"></textarea>
                        </div>


                        <!-- DRAG AND DROP  -->
                        <div class="input-group mt-2" *ngIf="q.value['question_type_description'] == 'drag_and_drop'">
                            <div *ngFor="let ans of q.value['answer_prompt'] | keyvalue" class="input-group mt-1">
                                <input type="text" (change)="inputEditor('drag_and_drop', q.key, 'answer_prompt', ans.key, $event.target.value)" class="form-control bucket_input_edit bucket_input_edit_question_{{q.key}}" id="bucket_input_edit_{{q.key}}" placeholder='Add a choice' style="padding: 0px;"
                                    value="{{ans.value}}">
                                <select list="bucket_list" (change)="inputEditor('drag_and_drop', q.key, 'answer_bucket_id', ans.key, $event.target.value)" class="form-control bucket_list_pick" id="bucket_list_pick_{{q.key}}" placeholder='Bucket' style="padding: 0px;">
                                        <option type='button' class="bucket_list_settings" value="add_edit">Add/Edit</option>
                                        <option disabled style="margin-top:8px; border-top:1px solid #666; padding:0;">
                                            ____________</option>
                                        <!-- <option *ngFor="let b of bucket_list" value="{{b.bucket_id}}"
                                            [selected]="q['answer_bucket_id'][ans.key] == b.bucket_id">
                                            {{b.bucket_name}}</option> -->
                                            <ng-container *ngFor="let b of bucket_list">
                                                    <option *ngIf="!b.soft_delete" [selected]="q.value['answer_bucket_id'][ans.key] == b.bucket_id" value="{{b.bucket_id}}">{{b.bucket_name}}</option>
                                                </ng-container>
                                    </select>
                                <div class="input-group-append">
                                    <button type="button" class='btn btn-danger' (click)="removeDragAndDropChoice(q.key, ans.key)">-</button>
                                </div>
                            </div>
                            <div class="input-group-prepend">
                                <button class="btn btn-outline-success bucket_input_add_button btn-action-borderless" (click)="dragAndDropAdder(q.key)" style="font-size: smaller; padding: 8px;" id='bucket_input_add_button_{{q.key}}' type="button">+</button>
                            </div>
                            <input type="text" (change)="inputEditor('drag_and_drop', q.key, 'temp_bucket_storage', 'answer_input', $event.target.value)" class="form-control bucket_input_add" id="bucket_input_add_input_{{q.key}}" placeholder='Add a choice' style="padding: 0px;">
                            <select *ngIf="bucketList_reloader[q.key]" list="bucket_list" type="text" (change)="inputEditor('drag_and_drop', q.key, 'temp_bucket_storage', 'bucket_id', $event.target.value)" class="form-control bucket_list_pick" id="bucket_list_pick_{{q.key}}" placeholder='Bucket' style="padding: 0px;">
                                    <option value="" selected disabled class="text-muted">Choose bucket</option>
                                    <option type='button' class="bucket_list_settings" value="add_edit">Add/Edit </option>
                                    <option disabled style="margin-top:8px; border-top:1px solid #666; padding:0;">____________</option>
                                    <ng-container *ngFor="let b of bucket_list">
                                        <option *ngIf="!b.soft_delete" value="{{b.bucket_id}}">{{b.bucket_name}}</option>
                                    </ng-container>
                                </select>
                        </div>


                        <!-- CHECKBOX  -->
                        <div *ngIf="q.value['display_type_description'] == 'Checkbox' && q.value['question_type_description'] = 'selected input'">
                            <div *ngFor="let ans of q.value['answer_prompt'] | keyvalue">
                                <div>
                                    <input class="answerChoice" style="margin: 5px" (change)="inputEditor('answer', q.key, 'answer_correct', ans.key, !q.value['answer_correct'][ans.key])" [checked]=q.value.answer_correct[ans.key] type="checkbox" id="checkbox_{{ans.key}}" title="Select the right answer. You can chose multiple."
                                    />
                                    <label for="checkbox_{{ans.key}}" style="margin:0px 0px; width:92%">
                                            <div class="input-group mb-1">
                                                <div class="input-group-prepend" style="width: 15%;">
                                                    <input type="number"
                                                        (change)="inputEditor('answer', q.key, 'answer_sort', ans.key, $event.target.value)"
                                                        class="answer_order_edit form-control create_form_input_shadow"
                                                        min="1" id="answer_order_edit_{{ans.key}}" style="width: 90%;"
                                                        value="{{q.value['answer_sort'][ans.key] }}"
                                                        data-toggle="tooltip" data-placement="bottom"
                                                        title="Set priority of the answer.">
                                                </div>
                                                <input class="form-control create_form_input_shadow" type="text"
                                                    id="answerId${id}" value="" aria-describedby="basic-addon2"
                                                    value='{{ans.value}}'
                                                    (change)="inputEditor('answer', q.key, 'answer_prompt', ans.key, $event.target.value)" />
                                                <div class="input-group-append">
                                                    <button class="btn btn-outline-danger buttonRemoveAnswer"
                                                        (click)="inputEditor('answer', q.key, 'answer_soft_delete', ans.key, true)"
                                                        [hidden]="q.value['answer_soft_delete'][ans.key]"
                                                        id='buttonRemoveAnswer${i}' type="button">-</button>
                                                </div>
                                            </div>
                                        </label>
                                </div>
                            </div>
                        </div>


                        <!-- DROPDOWN/SELECT -->
                        <div *ngIf="q.value['display_type_description'] == 'Dropdown' && q.value['question_type_description'] = 'selected input'">
                            <div *ngFor="let ans of q.value['answer_prompt'] | keyvalue" class="custom-radio">
                                <div>
                                    <input class="answerChoice" style="margin: 5px" (change)="inputEditor('answer',q.key, 'answer_correct', ans.key, !q.value['answer_correct'][ans.key])" [checked]=q.value.answer_correct[ans.key] type="radio" id="checkbox_{{ans.key}}" title="Select the right answer. You can chose only one answer."
                                        name="radio_answer_for_question_{{q.key}}" />
                                    <label for="checkbox_{{ans.key}}" style="margin:0px 0px; width:92%">
                                            <div class="input-group mb-1">
                                                <div class="input-group-prepend" style="width: 15%;">
                                                    <input type="number"
                                                        (change)="inputEditor('answer',q.key, 'answer_sort', ans.key, $event.target.value)"
                                                        class="form-control answer_order_edit create_form_input_shadow"
                                                        min="1" id="answer_order_edit_{{ans.key}}" style="width: 90%;"
                                                        value="{{q.value['answer_sort'][ans.key] }}"
                                                        data-toggle="tooltip" data-placement="bottom"
                                                        title="Set priority of the answer.">
                                                </div>
                                                <input class="form-control create_form_input_shadow" type="text"
                                                    id="answerId${id}" value="" aria-describedby="basic-addon2"
                                                    value='{{ans.value}}'
                                                    (change)="inputEditor('answer',q.key, 'answer_prompt', ans.key, $event.target.value)" />
                                                <div class="input-group-append">
                                                    <button class="btn btn-outline-danger buttonRemoveAnswer"
                                                        (click)="inputEditor('answer',q.key, 'answer_soft_delete', ans.key, true)"
                                                        [hidden]="q.value['answer_soft_delete'][ans.key]"
                                                        id='buttonRemoveAnswer${i}' type="button">-</button>
                                                </div>
                                            </div>
                                        </label>
                                </div>
                            </div>
                        </div>


                        <!-- RADIO -->
                        <div *ngIf="q.value['display_type_description'] == 'Radio' && q.value['question_type_description'] = 'selected input'">
                            <div *ngFor="let ans of q.value['answer_prompt'] | keyvalue" class="custom-radio">
                                <div>
                                    <input class="answerChoice" style="margin: 5px" (change)="inputEditor('answer',q.key, 'answer_correct', ans.key, !q.value['answer_correct'][ans.key])" [checked]=q.value.answer_correct[ans.key] type="radio" id="checkbox_{{ans.key}}" title="Select the right answer. You can chose only one answer."
                                        name="radio_answer_for_question_{{q.key}}" />
                                    <label for="checkbox_{{ans.key}}" style="margin:0px 0px; width:92%">
                                            <div class="input-group mb-1">
                                                <div class="input-group-prepend" style="width: 15%;">
                                                    <input type="number"
                                                        (change)="inputEditor('answer',q.key, 'answer_sort', ans.key, $event.target.value)"
                                                        class="form-control answer_order_edit create_form_input_shadow"
                                                        min="1" id="answer_order_edit_{{ans.key}}" style="width: 90%;"
                                                        value="{{q.value['answer_sort'][ans.key] }}"
                                                        data-toggle="tooltip" data-placement="bottom"
                                                        title="Set priority of the answer.">
                                                </div>
                                                <input class="form-control create_form_input_shadow" type="text"
                                                    id="answerId${id}" value="" aria-describedby="basic-addon2"
                                                    value='{{ans.value}}'
                                                    (change)="inputEditor('answer',q.key, 'answer_prompt', ans.key, $event.target.value)" />
                                                <div class="input-group-append">
                                                    <button class="btn btn-outline-danger buttonRemoveAnswer"
                                                        (click)="inputEditor('answer',q.key, 'answer_soft_delete', ans.key, true)"
                                                        [hidden]="q.value['answer_soft_delete'][ans.key]"
                                                        id='buttonRemoveAnswer${i}' type="button">-</button>
                                                </div>
                                            </div>
                                        </label>
                                </div>
                            </div>
                        </div>


                        <!-- ADD ANSWER FORM -->
                        <div style="padding-right: 3px !important;" class="input-group mb-3 create_form_input_shadow" [hidden]="!q.value['question_type_description'] || q.value['question_type_description'] == 'textfield input' || q.value['question_type_description'] == 'drag_and_drop'">
                            <div class="input-group-prepend" style="width: 25px">
                                <button class="btn btn-success create_form_answer_add btn-action-borderless" id='buttonAddNewAnswer_{{q.key}}' type="button" (click)="addAnswer(q.key)">+</button>
                            </div>
                            <input type="text" class="form-control create_form_input_shadowless  edit_quiz_input_text_add" id="newAnswerFor_{{q.key}}" placeholder='Add an answer' aria-describedby="basic-addon2">
                        </div>

                    </td>

                    <!-- ADMIN NOTES -->
                    <td *ngIf="!q.value['error_bool']">
                        <div class="input-group">
                            <input class="create_form_input_shadow form-control " value="{{list_of_questions[q.key]['training_url']}}" type="text" placeholder="Confluence link" (change)="inputEditor(null, q.key, 'training_url', null, $event.target.value)">
                            <div class="input-group-append">
                                <button type='button' class='buttonConfluenceLink btn btn-xs  btn-outline-dark' id='buttonConfluenceLinkForQuestion${id}' (click)="checkModuleLink(q.key)">Check</button>
                            </div>
                        </div>
                        <div id='module_field${id}'>
                            <input class="create_form_input_shadow form-control" value="{{list_of_questions[q.key]['training_module']}}" (change)="inputEditor('training_module', q.key,'training_module', null, $event.target.value)" id='editModuleForQuestionId${id}' type="text" placeholder="Module note">
                        </div>
                        <div class="input-group  mb-3" style="width: 75%">
                            <div class="input-group-prepend">
                                <span class="input-group-text" id="basic-addon3">Question value</span>
                            </div>
                            <input class="form-control create_form_input_shadow"  value="{{list_of_questions[q.key]['point_value']}}"   (change)="inputEditor('point_value', q.key,'point_value', null, $event.target.value)" type="number" min="1" max="10">
                        </div>
                    </td>

                    <!-- ACTION BUTTONS -->
                    <td style='text-align: center' *ngIf="!q.value['error_bool']">
                        <div>
                            <button class='btn btn-outline-primary btn-action-borderless' disabled style="width: 100%">🔍 Preview</button>
                            <button *ngIf="q.key == 'new_question'" class='btn btn-outline-success btn-action-borderless' (click)="addQuestion()" style="width: 100%">+ Add</button>
                            <button *ngIf="q.key != 'new_question'" class='btn btn-outline-danger btn-action-borderless' (click)="removeQuestion(q.key)" style="width: 100%">Remove</button>
                        </div>
                    </td>
                    <td *ngIf="q.value['error_bool']">
                        ERROR
                    </td>
                </tr>
                <!-- <tr *ngIf="list_of_questions.new_question_error" class="create_form_row">
                    <td colspan="7" (click)="errorHandlerRemover('new_question')" class="errorHandlerBox">
                        <div class="alert alert-danger shadow errorHandler" role="alert">
                            <p class="text-center" *ngFor="let el of list_of_questions.new_question_error.errors | keyvalue">
                                {{el.value}}
                            </p>
                        </div>
                    </td>
                </tr> -->
            </tbody>
        </table>
        {{list_of_questions | json }}


    </div>
</div>
<div *ngIf="!currentUser || !engagements" class=" loading_box ">
    <img class="loading_box-ing " src='./../../assets/loading.gif'>
</div>